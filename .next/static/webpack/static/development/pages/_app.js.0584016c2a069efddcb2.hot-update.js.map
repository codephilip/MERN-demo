{"version":3,"file":"static/webpack/static\\development\\pages\\_app.js.0584016c2a069efddcb2.hot-update.js","sources":["webpack:///./pages/_app.js"],"sourcesContent":["import App from \"next/app\";\nimport Layout from \"../components/_App/Layout\";\nimport { parseCookies, destroyCookie } from \"nookies\";\nimport { redirectUser } from \"../utils/auth\";\nimport baseUrl from \"../utils/baseUrl\";\nimport axios from \"axios\";\n\n\nclass MyApp extends App {\n  static async getInitialProps({ Component, ctx }) {\n    const { token } = parseCookies(ctx);\n\n    let pageProps = {};\n\n    if (Component.getInitialProps) {\n      pageProps = await Component.getInitialProps(ctx);\n    }\n\n    if (!token) {\n      const isProtectedRoute =\n        ctx.pathname === \"/account\" || ctx.pathname === \"/create\";\n      if (isProtectedRoute) {\n        redirectUser(ctx, \"/login\");\n      }\n    } else {\n      try {\n        const payload = { headers: { Authorization: token } };\n        const url = `${baseUrl}/api/account`;\n        const response = await axios.get(url, payload);\n        const user = response.data;\n        const isRoot = user.role === \"root\";\n        const isAdmin = user.role === \"admin\";\n        // if authenticated, but not of role 'admin' or 'root', redirect from '/create' page\n        const isNotPermitted =\n          !(isRoot || isAdmin) && ctx.pathname === \"/create\";\n        if (isNotPermitted) {\n          redirectUser(ctx, \"/\");\n        }\n        pageProps.user = user;\n      } catch (error) {\n        console.error(\"Error getting current user\", error);\n        // 1) Throw out invalid token\n        destroyCookie(ctx, \"token\");\n        // 2) Redirect to login\n        redirectUser(ctx, \"/login\");\n      }\n    }\n\n    return { pageProps };\n  }\n\n  render() {\n    const { Component, pageProps } = this.props;\n    return (\n      <Layout {...pageProps}>\n        <Component {...pageProps} />\n      </Layout>\n    );\n  }\n}\n\nexport default MyApp;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;AA2CA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;;;;;;;;;;;;;AAjDA;AACA;AAEA;AACA;AACA;;;;;;AACA;AACA;;AADA;AACA;;AAEA;;;;;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;;AACA;AACA;;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAGA;AAAA;AAAA;AACA;;;;;;;;;;;;;;;;;;AAzCA;AACA;AAoDA;;;;A","sourceRoot":""}